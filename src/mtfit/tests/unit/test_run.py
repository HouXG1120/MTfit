import unittest
import os
import glob

from mtfit.utilities.unittest_utils import run_tests as _run_tests
from mtfit.utilities.unittest_utils import debug_tests as _debug_tests
from mtfit.run import mtfit


class RunTestCase(unittest.TestCase):

    def test_mtfit(self):
        logfiles = glob.glob('*.log')
        import numpy as np
        data = {'PPolarity': {'Stations': {'Name': ['S0649', "S0162", "S0083"], 'Azimuth': np.array([90.0, 270.0, 180.0]), 'TakeOffAngle': np.array([30.0, 60.0, 35.])},
                              'Measured': np.matrix([[1], [-1], [-1]]), 'Error': np.matrix([[0.001], [0.5], [0.02]])}}
        mtfit(data, max_time=10, phy_mem=0.5, parallel=False, convert=False)
        self.assertTrue(os.path.exists('mtfitOutputMT.mat'))
        os.remove('mtfitOutputMT.mat')
        newlogfiles = glob.glob('*.log')
        for logfile in newlogfiles:
            if logfile not in logfiles:
                os.remove(logfile)

    def test_combine_mpi_output(self):
        self.output_mpi()
        mtfit(datafile='./', combine_mpi_output=True, max_time=10,
              phy_mem=0.5, parallel=False, convert=True, binary_file_version=1)
        self.assertTrue(os.path.exists('20120620223428431DC.mat'))
        self.clean_mpi()

    def output_mpi(self):
        uid = "20120620223428431"
        inv_file = "(dp0\nS'PPolarity'\np1\n(dp2\nS'Error'\np3\ncnumpy.core.multiarray\n_reconstruct\np4\n(cnumpy.matrixlib.defmatrix\nmatrix\np5\n(I0\ntp6\nS'b'\np7\ntp8\nRp9\n(I1\n(I19\nI1\ntp10\ncnumpy\ndtype\np11\n(S'f8'\np12\nI0\nI1\ntp13\nRp14\n(I3\nS'<'\np15\nNNNI-1\nI-1\nI0\ntp16\nbI01\nS'\\xfc\\xa9\\xf1\\xd2MbP?\\xfc\\xa9\\xf1\\xd2MbP?\\xfc\\xa9\\xf1\\xd2MbP?\\xfc\\xa9\\xf1\\xd2MbP?\\xfc\\xa9\\xf1\\xd2MbP?\\xfc\\xa9\\xf1\\xd2MbP?\\xfc\\xa9\\xf1\\xd2MbP?\\xfc\\xa9\\xf1\\xd2MbP?\\xfc\\xa9\\xf1\\xd2MbP?\\xfc\\xa9\\xf1\\xd2MbP?\\xfc\\xa9\\xf1\\xd2MbP?\\xfc\\xa9\\xf1\\xd2MbP?{\\x14\\xaeG\\xe1z\\x84?\\xfc\\xa9\\xf1\\xd2MbP?\\xfc\\xa9\\xf1\\xd2MbP?\\xfc\\xa9\\xf1\\xd2MbP?\\xfc\\xa9\\xf1\\xd2MbP?\\xfc\\xa9\\xf1\\xd2MbP?\\xfc\\xa9\\xf1\\xd2MbP?'\np17\ntp18\nbsS'Measured'\np19\ng4\n(g5\n(I0\ntp20\ng7\ntp21\nRp22\n(I1\n(I19\nI1\ntp23\ng11\n(S'i8'\np24\nI0\nI1\ntp25\nRp26\n(I3\nS'<'\np27\nNNNI-1\nI-1\nI0\ntp28\nbI01\nS'\\x01\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\xff\\xff\\xff\\xff\\xff\\xff\\xff\\xff\\x01\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x01\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x01\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\xff\\xff\\xff\\xff\\xff\\xff\\xff\\xff\\x01\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x01\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x01\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x01\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\xff\\xff\\xff\\xff\\xff\\xff\\xff\\xff\\x01\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x01\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x01\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x01\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\xff\\xff\\xff\\xff\\xff\\xff\\xff\\xff\\xff\\xff\\xff\\xff\\xff\\xff\\xff\\xff\\xff\\xff\\xff\\xff\\xff\\xff\\xff\\xff\\xff\\xff\\xff\\xff\\xff\\xff\\xff\\xff'\np29\ntp30\nbsS'Stations'\np31\n(dp32\nS'TakeOffAngle'\np33\ng4\n(g5\n(I0\ntp34\ng7\ntp35\nRp36\n(I1\n(I19\nI1\ntp37\ng14\nI01\nS'\\x00\\x00\\x00\\x00\\x00@W@fffff6a@ffffffP@\\x9a\\x99\\x99\\x99\\x99\\xf9V@\\x9a\\x99\\x99\\x99\\x99YP@\\xcd\\xcc\\xcc\\xcc\\xcc\\xacQ@fffffFP@\\x00\\x00\\x00\\x00\\x00@P@fffff&Q@\\x9a\\x99\\x99\\x99\\x999Q@\\x00\\x00\\x00\\x00\\x00\\xa0V@\\xcd\\xcc\\xcc\\xcc\\xccLP@33333\\xf3K@\\xcd\\xcc\\xcc\\xcc\\xccL[@\\x00\\x00\\x00\\x00\\x00@L@33333\\xb3W@fffff\\xc6T@\\xcd\\xcc\\xcc\\xcc\\xccLP@33333\\xf3W@'\np38\ntp39\nbsS'Name'\np40\n(lp41\nS'BURF'\np42\naS'REN'\np43\naS'GHA'\np44\naS'K190'\np45\naS'SKI'\np46\naS'BLAF'\np47\naS'N66D'\np48\naS'VVAT'\np49\naS'K008'\np50\naS'SKOG'\np51\naS'HVAN'\np52\naS'GUDF'\np53\naS'SVA'\np54\naS'K250'\np55\naS'BUNG'\np56\naS'KVO'\np57\naS'TREB'\np58\naS'KODA'\np59\naS'K115'\np60\nasS'Azimuth'\np61\ng4\n(g5\n(I0\ntp62\ng7\ntp63\nRp64\n(I1\n(I19\nI1\ntp65\ng14\nI01\nS'\\xcd\\xcc\\xcc\\xcc\\xcc\\xac\\\\@fffff\\xe6r@\\x00\\x00\\x00\\x00\\x00\\x005@fffff~s@\\x9a\\x99\\x99\\x99\\x99qu@\\x9a\\x99\\x99\\x99\\x99\\te@fffffVv@\\x9a\\x99\\x99\\x99\\x99yv@\\x9a\\x99\\x99\\x99\\x99\\x99%@fffff\\xc6[@fffff\\xf6c@33333\\xe3u@\\xcd\\xcc\\xcc\\xcc\\xcc\\xfci@ffffffL@\\x00\\x00\\x00\\x00\\x00\\x00!@fffff\\xfeu@\\x9a\\x99\\x99\\x99\\x999e@33333#f@33333;v@'\np66\ntp67\nbsssS'UID'\np68\nS'20120620223428431'\np69\ns."
        mt_0 = '\x8d \x00\x00\x00\x00\x00\x00\x01\x00\x00\x00\x00\x00\x00\x00\x01\x900\x17\xa0\xd0\xdc.\xc0\xf6\xad\x1b\x1b\x1d"[?\xa3^\xbb\xc5\xfa\x9c\x19\xc0\xe4Z\xee\x9d}\x90\x93\xbf\x1c\xaf\xc3+\xbe\xa8\xea?E<\xd4>:\x0c\xea\xbf\x17\xd4\tz\xeak\xd6?$\xe0\xe0\xc5\xd0\xb6\xcf?\xf4ZJ\xc5\x95\xb8\xd7\xbf\xb0LX\xe8z\xb6\xbb\xbc\x00\x00\x00\x00\x00\x00\xd8<\x1e\xaa\xcd\xa3\x1cX\t@A]\xc4\xd8Q:\xe1?:kr\x1bZ\xcf\xf1\xbf\xfa\xff\xff\xff\xff\xff\xcf\xbc\xfc\xff\xff\xff\xff\xff\xd3<)\x02vy\xf1\xf0s@\xea\x85M)\xc8qD@\x97\x99\xa0\xc7\xd9*_\xc0\xf3\x10\xac\xb5u\xb0f@\x967g<\xb2\xb6L@P>\xba\x01}\xe3O\xc0'
        mt_11 = "\x8d \x00\x00\x00\x00\x00\x00\x01\x00\x00\x00\x00\x00\x00\x00\x01\xc6n\xe8q\x10\x83E\xc0!\xee\xff\xff\xff\xff\xde<v\x0e\x9a\xa2{\xff@\xc03\xab-L#{\xa1?\xa3\xac\xff\xa0\xe26\xea?V\x87\xc2\xd5\x94N\xeb\xbf(\xe7\xc1\xa8\xba\xb7\xda?\xf1,'\xba\xf2-\xd4?\xf7\xc8\xad\x8b!\xac\xc4\xbf#3\x90E\xa7y\xb2\xbc\x00\x00\x00\x00\x00\x00\xd4<@\xff\xac6\xa0\xca\x08@\x92\x15\x9b\xab\xd4\x9a\xe4?\x82N\xd1>\xa8\xc1\xf0\xbfTUUUUU\xc5\xbcUUUUUU\xd1<R\x88\x84\xe4\xe3\xbas@\xdd9\x9f\xfc\xd8?H@\x8f\xc3\xaa5\x8f-^\xc0\x94\xaep\x7f\xcb1f@5\x89\xbapW\xf5H@f\xa2b\x07\x9a\x00N\xc0"
        mt_2 = '\x8d \x00\x00\x00\x00\x00\x00\x01\x00\x00\x00\x00\x00\x00\x00\x01>\xbd\x06\xe7\x1f\x80/\xc0\x00Dy\x12$\xb9S?\xffw\x9aS\x99\xe3\x1a\xc0\x9f\x98\xcc\x92*\x8e\xb5?[w\x0f\x93\xbbJ\xe9?o\ni\xe5\x80\xfc\xeb\xbf4]\xab\xf9\x97\x05\xdc?k\x04R\xc7\x88\x89\xd2?I\xb0\xabm\x0c\xab\xc4\xbfPF\xa6\xffEg\xb9\xbc\x00\x00\x00\x00\x00\x00\xd4<\x1a@\x13\x03\xf6H\x08@\xbf\x07\xea\xac\x1a\xe6\xe4?\xf1\x15\xd2r\x01[\xf1\xbf\xac\xaa\xaa\xaa\xaa\xaa\xca\xbc\xac\xaa\xaa\xaa\xaa\xaa\xd2<M\x05\xd3\x80\xb6\xbde@A\xb2\xc7$\xd0\x9cH@\x8b\xbf\xd3\xc7+\x13O\xc0\x90.\x92\xcbG\xafs@(-\xbc\xe7\xb1\xfbG@\xd1\xb2\xe5=k\x9c]\xc0'
        mt_4 = '\x8d \x00\x00\x00\x00\x00\x00\x03\x00\x00\x00\x00\x00\x00\x00\x01\xc1\xe3\x9a\xf5|\xcb@\xc02\t^R\xf9\x7f\x12=\xaf"\x01\x05V\xbd?\xc08\x92Hn\x15r\xac?\x1f\xa4\xb7\x1fx\xa1\xe9?C-\x9cv\x99h\xeb\xbfK\x8a\x8d\x92\xdbn\xd9?\x1b\x0bFW\xd3\x12\xcb?YJ\x16\x87\xc7\r\xd5\xbf\xeb?\xf4\x16\x11\x18\xc7\xbc\x00\x00\x00\x00\x00\x00\xd8<$\xa8E\xa0K\x87\x08@\x9e\xe8\x8d2\xa1Y\xe2?\xf8!\x1d\xeb\xbdZ\xf2\xbf\xa7\xaa\xaa\xaa\xaa\xaa\xda\xbcRUUUUU\xd5<\xd0i\t)\xdc\xd7s@\xc1\x0el\xcd\x8e\xd7D@\x8c7\x1cS;\x1b^\xc0\xdc\xac\x91\x80\x84\xf5e@\x1a\xb9\xba\x1d6\x81K@\xa5n\xfaO\x88nP\xc0\x04\na\x01S\xa6\xb7=\xf0\x13ef\x02\x908\xc0\xf8"\xffF\xf5\x8b\xa9?\xce\x81\xdeX\x95>\xea?\xfesN\xadT\xd7\xeb\xbf\xd9\xf8\x9c\xf9\xfcl\xda?h\xef\x1d\x82[\x14\xd3?\xb7\xcd\x8b\xdf6\x13\xc4\xbf\xec?\xf4\x16\x11\x18\xb7\xbc\x00\x00\x00\x00\x00\x00\xd0<!\xc0\xeb\xf5\xf1\x9d\x08@ \xf0I\xd7\x02\xca\xe4?\xae\xe2^\x11\xab=\xf1\xbf\xac\xaa\xaa\xaa\xaa\xaa\xca\xbcWUUUUU\xcd<!:\xd1\xed3\xcbs@Aln\x96G\xfbG@1Z\xc6\x9cP\xbf]\xc0\xdc\xdc\xf6p\xcb\tf@\xba\xff\xc0\xb6\xf5\xbdH@\x9d\x12\xe9~\xa4\xdeN\xc0\x87\x9f\x07\x0c(?u<\xfe\xc4\t0-DC\xc0`\x0cP\x83\x97F\x84?\xbf\xce\x96j\x98\x90\xeb?\xf1\x0e\xa4\xc8\xb2\xe1\xeb\xbf\x85\x91\xd9\xb9\x0e\xe5\xd6?\x1c\xc3\x93v\x8b\xfd\xd0?\xfb\xbd\x9a\xb6\xd6\xe1\xcc\xbf\xc1,\xde\\r*\xc0\xbc\x00\x00\x00\x00\x00\x00\xd8<\xe9N\xea\xda\'\x05\t@\xfa\xad\xf1\x05O\xa3\xe3?3\xa7,\x829\xe2\xf1\xbf\xac\xaa\xaa\xaa\xaa\xaa\xd2\xbcVUUUUU\xd5<\xbb\xfc\xd3\xdbJ\x0ct@(\xaa\xaa\xa2\x0ccF@\x1d\xd5?\xc3\xbe\xd8]\xc0<\xfe!\x8d1ff@(R\x8f\x18`\x12J@\x806y\xcc\xa3\x02P\xc0'
        mt_5 = '\x8d \x00\x00\x00\x00\x00\x00\x02\x00\x00\x00\x00\x00\x00\x00\x01\x005.\xb9;\x11"\xc0\xe0m"\x833\xd1\xef?g\xdd:pkww\xbf^\x7f\x96\x89\xf8\xac\xb3?\x8d,\xadN\xcb3\xe9?x\xfc\xdf_j\xa9\xeb\xbfV6\x9d\xa2a\xd4\xdb?\x99\xba[\x12\xc1\x96\xd0?-\xb14\xd6\xc0\x90\xce\xbf\xf1/7\xd1\x0cR\xc1\xbc\x00\x00\x00\x00\x00\x00\xd4<\xed\x901S3\\\x08@\x81\x11\xd2\xc3{\xbd\xe3?o\xb9b\xc1\x9f\x90\xf1\xbfWUUUUU\xd5\xbc\xac\xaa\xaa\xaa\xaa\xaa\xd2<L\x02\xbb\xeb\xa1\xacs@\xb6\x91\x98\\\xb2\xc2F@\x12?\xe7\xde\x9e\n^\xc0\xf3\x0ch\xdf\xef\xcee@\xba9\xaaT\xa6\xf4I@\x109t\xa3,sO\xc0\xc3\xbd\x12j]\xa0\t?\xbc#\xcdC3\xda#\xc0*9nto*\xa3\xbfV\x1e\x1d\xcd\xbf"\xeb?\xc3:\xd6\xd5\x18\xf0\xe9\xbf\xab\x0cu\x1f\xcd\xef\xd6?\xdf\xb4T8"3\xd2?\xc2g\x9fs1o\xd4\xbfPF\xa6\xffEg\xb9\xbc\x00\x00\x00\x00\x00\x00\xd4<a:V\xd2\xf4\x86\t@z\xea\x85\x14d\xd1\xe1?\xcdp[\x94\xbc\x16\xf1\xbf\xac\xaa\xaa\xaa\xaa\xaa\xca\xbc\xac\xaa\xaa\xaa\xaa\xaa\xd2<\xef`H\xabe\xdaf@/\xd0i@\x0e\x15L@\x96j*\x91\xef\x98N\xc0\x97\xb5I\r\xf2\xe2s@\xc8&\xf0\xdaz\xa5E@\xedf9\x04Sm_\xc0'
        mt_7 = "\x8d \x00\x00\x00\x00\x00\x00\x01\x00\x00\x00\x00\x00\x00\x00\x01\xb2\xda3\x7f0\xf30\xc0\xf4#\x92\xdf\xd1\xc47?Lh\\\x82\x1b\xb0\x1f\xc0\xc8\xed:`i\xff\xb7?\xedr\x16a\xd4\xef\xe8?\xa6\xd0\x1d\x8d\xc1\xef\xeb\xbf&D3\x9d\xa8|\xdb?\xedX=E-\xfa\xcb?\xdb \xe4\xa6(\xf3\xd1\xbf\x889B.\xdc\xc8\xc4\xbc\x00\x00\x00\x00\x00\x00\xd8<l\xed\xfa\xcf\xb4'\x08@\xe4\xe7\xc5\xad;=\xe3?\xe7\xc57c\xf7<\xf2\xbf\xfe\xff\xff\xff\xff\xff\xd7\xbc\xff\xff\xff\xff\xff\xff\xd3<\x88\xdc\x04\xc9\x84\xb9s@F\x93R\xc7\xfc\xb8E@`\xbf\xb2)b\xc2]\xc0\x9f\x9b2\x17\xf1\x9fe@*\xecwCk\x85J@\t\x93\x97D\xe0SP\xc0"
        mt_9 = '\x8d \x00\x00\x00\x00\x00\x00\x01\x00\x00\x00\x00\x00\x00\x00\x01\x8f"8\x0b\xf3eG\xc0-3\xf4\xf9C\xcf\x86<?\xc2\xe9;^\xe2B\xc0\x8d\x89+\xde\x13_\xb1?\xef\xdb\xb44\x02\xa5\xea?!Mz\xb0\xe4\xd0\xec\xbf=s\xcc\xab\xafF\xd9?\xfd\xb3`\xfcr\xcb\xd1?\x9ea8`\x17i\xbc\xbf\xbf,\xde\\r*\xc0\xbc\x00\x00\x00\x00\x00\x00\xd4<\xb9\x03\xec\xc9\xee^\x08@\xc7:\xccU\xf1\x8c\xe5?\xea\xb8}\x1c{\x14\xf2\xbf\xaa\xaa\xaa\xaa\xaa\xaa\xd2\xbcUUUUUU\xd1<\xdcs\xb2\x10b\xd1e@\x83\xd3\x04K6\xd5G@\xeaNp\xaf\xa1/P\xc08\x9fIc\x83\xf8s@\x08Uf\x06\x8f\x05H@v\x92#\xd4\x15\xc6\\\xc0'
        mts = [mt_0, mt_2, mt_4, mt_5, mt_7, mt_9, mt_11]
        hyp_0 = 'NLLOC 20120620223428431\nSIGNATURE mtfit 1.0.0B/2015-10-21T16:42:43.417409\nCOMMENT mtfit inversion\nGRID None\nSEARCH None\nHYPOCENTER x ? y ? z ? OT ? ix ? iy ? iz ?\nGEOGRAPHIC OT ? ? ? ? ? ? Lat ? Long ? Depth ?\nQUALITY Pmax ? MFmin ? MFmax ? RMS ? Nphs ? Gap ? Dist ? Mamp ? ? Mdur ? ?\nVPVSRATIO ? ?\nSTATISTICS ExpectX ? Y ? Z ? CovXX ? XY ? XZ ? YY ? YZ ? ZZ ? EllAz1 ? Dip1 ? Len1 ? Az2 ? Dip2 ? Len2 ? Len3 ?\nTRANS None\nFOCALMECH ? ? ? Mech 181.514368855 57.4273143295 -63.7772524032 mf 0 nObs 0\nPHASE ID Ins Cmp On Pha FM Date HrMn Sec Err ErrMag Coda Amp Per > TTpred Res Weight StaLoc(X Y Z) SDist SAzim RAz RDip RQual Tcorr\nBURF ? ? ? P U ? ? ? ? ? ? ? ? > ? ? ? ? ? ? ? ? 114.7 93.0 ? ?\nREN ? ? ? P D ? ? ? ? ? ? ? ? > ? ? ? ? ? ? ? ? 302.4 137.7 ? ?\nGHA ? ? ? P U ? ? ? ? ? ? ? ? > ? ? ? ? ? ? ? ? 21.0 65.6 ? ?\nK190 ? ? ? P U ? ? ? ? ? ? ? ? > ? ? ? ? ? ? ? ? 311.9 91.9 ? ?\nSKI ? ? ? P U ? ? ? ? ? ? ? ? > ? ? ? ? ? ? ? ? 343.1 65.4 ? ?\nBLAF ? ? ? P D ? ? ? ? ? ? ? ? > ? ? ? ? ? ? ? ? 168.3 70.7 ? ?\nN66D ? ? ? P U ? ? ? ? ? ? ? ? > ? ? ? ? ? ? ? ? 357.4 65.1 ? ?\nVVAT ? ? ? P U ? ? ? ? ? ? ? ? > ? ? ? ? ? ? ? ? 359.6 65.0 ? ?\nK008 ? ? ? P U ? ? ? ? ? ? ? ? > ? ? ? ? ? ? ? ? 10.8 68.6 ? ?\nSKOG ? ? ? P U ? ? ? ? ? ? ? ? > ? ? ? ? ? ? ? ? 111.1 68.9 ? ?\nHVAN ? ? ? P D ? ? ? ? ? ? ? ? > ? ? ? ? ? ? ? ? 159.7 90.5 ? ?\nGUDF ? ? ? P U ? ? ? ? ? ? ? ? > ? ? ? ? ? ? ? ? 350.2 65.2 ? ?\nSVA ? ? ? P U ? ? ? ? ? ? ? ? > ? ? ? ? ? ? ? ? 207.9 55.9 ? ?\nK250 ? ? ? P U ? ? ? ? ? ? ? ? > ? ? ? ? ? ? ? ? 56.8 109.2 ? ?\nBUNG ? ? ? P U ? ? ? ? ? ? ? ? > ? ? ? ? ? ? ? ? 8.5 56.5 ? ?\nKVO ? ? ? P D ? ? ? ? ? ? ? ? > ? ? ? ? ? ? ? ? 351.9 94.8 ? ?\nTREB ? ? ? P D ? ? ? ? ? ? ? ? > ? ? ? ? ? ? ? ? 169.8 83.1 ? ?\nKODA ? ? ? P D ? ? ? ? ? ? ? ? > ? ? ? ? ? ? ? ? 177.1 65.2 ? ?\nK115 ? ? ? P D ? ? ? ? ? ? ? ? > ? ? ? ? ? ? ? ? 355.7 95.8 ? ?\nEND_PHASE\nEND_NLLOC\n'
        hyp_11 = 'NLLOC 20120620223428431\nSIGNATURE mtfit 1.0.0B/2015-10-21T16:42:43.415002\nCOMMENT mtfit inversion\nGRID None\nSEARCH None\nHYPOCENTER x ? y ? z ? OT ? ix ? iy ? iz ?\nGEOGRAPHIC OT ? ? ? ? ? ? Lat ? Long ? Depth ?\nQUALITY Pmax ? MFmin ? MFmax ? RMS ? Nphs ? Gap ? Dist ? Mamp ? ? Mdur ? ?\nVPVSRATIO ? ?\nSTATISTICS ExpectX ? Y ? Z ? CovXX ? XY ? XZ ? YY ? YZ ? ZZ ? EllAz1 ? Dip1 ? Len1 ? Az2 ? Dip2 ? Len2 ? Len3 ?\nTRANS None\nFOCALMECH ? ? ? Mech 177.556091042 49.9167309676 -60.0047005874 mf 0 nObs 0\nPHASE ID Ins Cmp On Pha FM Date HrMn Sec Err ErrMag Coda Amp Per > TTpred Res Weight StaLoc(X Y Z) SDist SAzim RAz RDip RQual Tcorr\nBURF ? ? ? P U ? ? ? ? ? ? ? ? > ? ? ? ? ? ? ? ? 114.7 93.0 ? ?\nREN ? ? ? P D ? ? ? ? ? ? ? ? > ? ? ? ? ? ? ? ? 302.4 137.7 ? ?\nGHA ? ? ? P U ? ? ? ? ? ? ? ? > ? ? ? ? ? ? ? ? 21.0 65.6 ? ?\nK190 ? ? ? P U ? ? ? ? ? ? ? ? > ? ? ? ? ? ? ? ? 311.9 91.9 ? ?\nSKI ? ? ? P U ? ? ? ? ? ? ? ? > ? ? ? ? ? ? ? ? 343.1 65.4 ? ?\nBLAF ? ? ? P D ? ? ? ? ? ? ? ? > ? ? ? ? ? ? ? ? 168.3 70.7 ? ?\nN66D ? ? ? P U ? ? ? ? ? ? ? ? > ? ? ? ? ? ? ? ? 357.4 65.1 ? ?\nVVAT ? ? ? P U ? ? ? ? ? ? ? ? > ? ? ? ? ? ? ? ? 359.6 65.0 ? ?\nK008 ? ? ? P U ? ? ? ? ? ? ? ? > ? ? ? ? ? ? ? ? 10.8 68.6 ? ?\nSKOG ? ? ? P U ? ? ? ? ? ? ? ? > ? ? ? ? ? ? ? ? 111.1 68.9 ? ?\nHVAN ? ? ? P D ? ? ? ? ? ? ? ? > ? ? ? ? ? ? ? ? 159.7 90.5 ? ?\nGUDF ? ? ? P U ? ? ? ? ? ? ? ? > ? ? ? ? ? ? ? ? 350.2 65.2 ? ?\nSVA ? ? ? P U ? ? ? ? ? ? ? ? > ? ? ? ? ? ? ? ? 207.9 55.9 ? ?\nK250 ? ? ? P U ? ? ? ? ? ? ? ? > ? ? ? ? ? ? ? ? 56.8 109.2 ? ?\nBUNG ? ? ? P U ? ? ? ? ? ? ? ? > ? ? ? ? ? ? ? ? 8.5 56.5 ? ?\nKVO ? ? ? P D ? ? ? ? ? ? ? ? > ? ? ? ? ? ? ? ? 351.9 94.8 ? ?\nTREB ? ? ? P D ? ? ? ? ? ? ? ? > ? ? ? ? ? ? ? ? 169.8 83.1 ? ?\nKODA ? ? ? P D ? ? ? ? ? ? ? ? > ? ? ? ? ? ? ? ? 177.1 65.2 ? ?\nK115 ? ? ? P D ? ? ? ? ? ? ? ? > ? ? ? ? ? ? ? ? 355.7 95.8 ? ?\nEND_PHASE\nEND_NLLOC\n'
        hyp_2 = 'NLLOC 20120620223428431\nSIGNATURE mtfit 1.0.0B/2015-10-21T16:42:43.418674\nCOMMENT mtfit inversion\nGRID None\nSEARCH None\nHYPOCENTER x ? y ? z ? OT ? ix ? iy ? iz ?\nGEOGRAPHIC OT ? ? ? ? ? ? Lat ? Long ? Depth ?\nQUALITY Pmax ? MFmin ? MFmax ? RMS ? Nphs ? Gap ? Dist ? Mamp ? ? Mdur ? ?\nVPVSRATIO ? ?\nSTATISTICS ExpectX ? Y ? Z ? CovXX ? XY ? XZ ? YY ? YZ ? ZZ ? EllAz1 ? Dip1 ? Len1 ? Az2 ? Dip2 ? Len2 ? Len3 ?\nTRANS None\nFOCALMECH ? ? ? Mech 173.928528225 49.2251020408 -62.1497735771 mf 0 nObs 0\nPHASE ID Ins Cmp On Pha FM Date HrMn Sec Err ErrMag Coda Amp Per > TTpred Res Weight StaLoc(X Y Z) SDist SAzim RAz RDip RQual Tcorr\nBURF ? ? ? P U ? ? ? ? ? ? ? ? > ? ? ? ? ? ? ? ? 114.7 93.0 ? ?\nREN ? ? ? P D ? ? ? ? ? ? ? ? > ? ? ? ? ? ? ? ? 302.4 137.7 ? ?\nGHA ? ? ? P U ? ? ? ? ? ? ? ? > ? ? ? ? ? ? ? ? 21.0 65.6 ? ?\nK190 ? ? ? P U ? ? ? ? ? ? ? ? > ? ? ? ? ? ? ? ? 311.9 91.9 ? ?\nSKI ? ? ? P U ? ? ? ? ? ? ? ? > ? ? ? ? ? ? ? ? 343.1 65.4 ? ?\nBLAF ? ? ? P D ? ? ? ? ? ? ? ? > ? ? ? ? ? ? ? ? 168.3 70.7 ? ?\nN66D ? ? ? P U ? ? ? ? ? ? ? ? > ? ? ? ? ? ? ? ? 357.4 65.1 ? ?\nVVAT ? ? ? P U ? ? ? ? ? ? ? ? > ? ? ? ? ? ? ? ? 359.6 65.0 ? ?\nK008 ? ? ? P U ? ? ? ? ? ? ? ? > ? ? ? ? ? ? ? ? 10.8 68.6 ? ?\nSKOG ? ? ? P U ? ? ? ? ? ? ? ? > ? ? ? ? ? ? ? ? 111.1 68.9 ? ?\nHVAN ? ? ? P D ? ? ? ? ? ? ? ? > ? ? ? ? ? ? ? ? 159.7 90.5 ? ?\nGUDF ? ? ? P U ? ? ? ? ? ? ? ? > ? ? ? ? ? ? ? ? 350.2 65.2 ? ?\nSVA ? ? ? P U ? ? ? ? ? ? ? ? > ? ? ? ? ? ? ? ? 207.9 55.9 ? ?\nK250 ? ? ? P U ? ? ? ? ? ? ? ? > ? ? ? ? ? ? ? ? 56.8 109.2 ? ?\nBUNG ? ? ? P U ? ? ? ? ? ? ? ? > ? ? ? ? ? ? ? ? 8.5 56.5 ? ?\nKVO ? ? ? P D ? ? ? ? ? ? ? ? > ? ? ? ? ? ? ? ? 351.9 94.8 ? ?\nTREB ? ? ? P D ? ? ? ? ? ? ? ? > ? ? ? ? ? ? ? ? 169.8 83.1 ? ?\nKODA ? ? ? P D ? ? ? ? ? ? ? ? > ? ? ? ? ? ? ? ? 177.1 65.2 ? ?\nK115 ? ? ? P D ? ? ? ? ? ? ? ? > ? ? ? ? ? ? ? ? 355.7 95.8 ? ?\nEND_PHASE\nEND_NLLOC\n'
        hyp_4 = 'NLLOC 20120620223428431\nSIGNATURE mtfit 1.0.0B/2015-10-21T16:42:43.402503\nCOMMENT mtfit inversion\nGRID None\nSEARCH None\nHYPOCENTER x ? y ? z ? OT ? ix ? iy ? iz ?\nGEOGRAPHIC OT ? ? ? ? ? ? Lat ? Long ? Depth ?\nQUALITY Pmax ? MFmin ? MFmax ? RMS ? Nphs ? Gap ? Dist ? Mamp ? ? Mdur ? ?\nVPVSRATIO ? ?\nSTATISTICS ExpectX ? Y ? Z ? CovXX ? XY ? XZ ? YY ? YZ ? ZZ ? EllAz1 ? Dip1 ? Len1 ? Az2 ? Dip2 ? Len2 ? Len3 ?\nTRANS None\nFOCALMECH ? ? ? Mech 176.306084139 49.4840610926 -61.7393950117 mf 0 nObs 0\nPHASE ID Ins Cmp On Pha FM Date HrMn Sec Err ErrMag Coda Amp Per > TTpred Res Weight StaLoc(X Y Z) SDist SAzim RAz RDip RQual Tcorr\nBURF ? ? ? P U ? ? ? ? ? ? ? ? > ? ? ? ? ? ? ? ? 114.7 93.0 ? ?\nREN ? ? ? P D ? ? ? ? ? ? ? ? > ? ? ? ? ? ? ? ? 302.4 137.7 ? ?\nGHA ? ? ? P U ? ? ? ? ? ? ? ? > ? ? ? ? ? ? ? ? 21.0 65.6 ? ?\nK190 ? ? ? P U ? ? ? ? ? ? ? ? > ? ? ? ? ? ? ? ? 311.9 91.9 ? ?\nSKI ? ? ? P U ? ? ? ? ? ? ? ? > ? ? ? ? ? ? ? ? 343.1 65.4 ? ?\nBLAF ? ? ? P D ? ? ? ? ? ? ? ? > ? ? ? ? ? ? ? ? 168.3 70.7 ? ?\nN66D ? ? ? P U ? ? ? ? ? ? ? ? > ? ? ? ? ? ? ? ? 357.4 65.1 ? ?\nVVAT ? ? ? P U ? ? ? ? ? ? ? ? > ? ? ? ? ? ? ? ? 359.6 65.0 ? ?\nK008 ? ? ? P U ? ? ? ? ? ? ? ? > ? ? ? ? ? ? ? ? 10.8 68.6 ? ?\nSKOG ? ? ? P U ? ? ? ? ? ? ? ? > ? ? ? ? ? ? ? ? 111.1 68.9 ? ?\nHVAN ? ? ? P D ? ? ? ? ? ? ? ? > ? ? ? ? ? ? ? ? 159.7 90.5 ? ?\nGUDF ? ? ? P U ? ? ? ? ? ? ? ? > ? ? ? ? ? ? ? ? 350.2 65.2 ? ?\nSVA ? ? ? P U ? ? ? ? ? ? ? ? > ? ? ? ? ? ? ? ? 207.9 55.9 ? ?\nK250 ? ? ? P U ? ? ? ? ? ? ? ? > ? ? ? ? ? ? ? ? 56.8 109.2 ? ?\nBUNG ? ? ? P U ? ? ? ? ? ? ? ? > ? ? ? ? ? ? ? ? 8.5 56.5 ? ?\nKVO ? ? ? P D ? ? ? ? ? ? ? ? > ? ? ? ? ? ? ? ? 351.9 94.8 ? ?\nTREB ? ? ? P D ? ? ? ? ? ? ? ? > ? ? ? ? ? ? ? ? 169.8 83.1 ? ?\nKODA ? ? ? P D ? ? ? ? ? ? ? ? > ? ? ? ? ? ? ? ? 177.1 65.2 ? ?\nK115 ? ? ? P D ? ? ? ? ? ? ? ? > ? ? ? ? ? ? ? ? 355.7 95.8 ? ?\nEND_PHASE\nEND_NLLOC\n'
        hyp_5 = 'NLLOC 20120620223428431\nSIGNATURE mtfit 1.0.0B/2015-10-21T16:42:43.400688\nCOMMENT mtfit inversion\nGRID None\nSEARCH None\nHYPOCENTER x ? y ? z ? OT ? ix ? iy ? iz ?\nGEOGRAPHIC OT ? ? ? ? ? ? Lat ? Long ? Depth ?\nQUALITY Pmax ? MFmin ? MFmax ? RMS ? Nphs ? Gap ? Dist ? Mamp ? ? Mdur ? ?\nVPVSRATIO ? ?\nSTATISTICS ExpectX ? Y ? Z ? CovXX ? XY ? XZ ? YY ? YZ ? ZZ ? EllAz1 ? Dip1 ? Len1 ? Az2 ? Dip2 ? Len2 ? Len3 ?\nTRANS None\nFOCALMECH ? ? ? Mech 174.466781333 51.9113260108 -62.8997997587 mf 0 nObs 0\nPHASE ID Ins Cmp On Pha FM Date HrMn Sec Err ErrMag Coda Amp Per > TTpred Res Weight StaLoc(X Y Z) SDist SAzim RAz RDip RQual Tcorr\nBURF ? ? ? P U ? ? ? ? ? ? ? ? > ? ? ? ? ? ? ? ? 114.7 93.0 ? ?\nREN ? ? ? P D ? ? ? ? ? ? ? ? > ? ? ? ? ? ? ? ? 302.4 137.7 ? ?\nGHA ? ? ? P U ? ? ? ? ? ? ? ? > ? ? ? ? ? ? ? ? 21.0 65.6 ? ?\nK190 ? ? ? P U ? ? ? ? ? ? ? ? > ? ? ? ? ? ? ? ? 311.9 91.9 ? ?\nSKI ? ? ? P U ? ? ? ? ? ? ? ? > ? ? ? ? ? ? ? ? 343.1 65.4 ? ?\nBLAF ? ? ? P D ? ? ? ? ? ? ? ? > ? ? ? ? ? ? ? ? 168.3 70.7 ? ?\nN66D ? ? ? P U ? ? ? ? ? ? ? ? > ? ? ? ? ? ? ? ? 357.4 65.1 ? ?\nVVAT ? ? ? P U ? ? ? ? ? ? ? ? > ? ? ? ? ? ? ? ? 359.6 65.0 ? ?\nK008 ? ? ? P U ? ? ? ? ? ? ? ? > ? ? ? ? ? ? ? ? 10.8 68.6 ? ?\nSKOG ? ? ? P U ? ? ? ? ? ? ? ? > ? ? ? ? ? ? ? ? 111.1 68.9 ? ?\nHVAN ? ? ? P D ? ? ? ? ? ? ? ? > ? ? ? ? ? ? ? ? 159.7 90.5 ? ?\nGUDF ? ? ? P U ? ? ? ? ? ? ? ? > ? ? ? ? ? ? ? ? 350.2 65.2 ? ?\nSVA ? ? ? P U ? ? ? ? ? ? ? ? > ? ? ? ? ? ? ? ? 207.9 55.9 ? ?\nK250 ? ? ? P U ? ? ? ? ? ? ? ? > ? ? ? ? ? ? ? ? 56.8 109.2 ? ?\nBUNG ? ? ? P U ? ? ? ? ? ? ? ? > ? ? ? ? ? ? ? ? 8.5 56.5 ? ?\nKVO ? ? ? P D ? ? ? ? ? ? ? ? > ? ? ? ? ? ? ? ? 351.9 94.8 ? ?\nTREB ? ? ? P D ? ? ? ? ? ? ? ? > ? ? ? ? ? ? ? ? 169.8 83.1 ? ?\nKODA ? ? ? P D ? ? ? ? ? ? ? ? > ? ? ? ? ? ? ? ? 177.1 65.2 ? ?\nK115 ? ? ? P D ? ? ? ? ? ? ? ? > ? ? ? ? ? ? ? ? 355.7 95.8 ? ?\nEND_PHASE\nEND_NLLOC\n'
        hyp_7 = 'NLLOC 20120620223428431\nSIGNATURE mtfit 1.0.0B/2015-10-21T16:42:43.380454\nCOMMENT mtfit inversion\nGRID None\nSEARCH None\nHYPOCENTER x ? y ? z ? OT ? ix ? iy ? iz ?\nGEOGRAPHIC OT ? ? ? ? ? ? Lat ? Long ? Depth ?\nQUALITY Pmax ? MFmin ? MFmax ? RMS ? Nphs ? Gap ? Dist ? Mamp ? ? Mdur ? ?\nVPVSRATIO ? ?\nSTATISTICS ExpectX ? Y ? Z ? CovXX ? XY ? XZ ? YY ? YZ ? ZZ ? EllAz1 ? Dip1 ? Len1 ? Az2 ? Dip2 ? Len2 ? Len3 ?\nTRANS None\nFOCALMECH ? ? ? Mech 172.998180007 53.0423359237 -65.3105632286 mf 0 nObs 0\nPHASE ID Ins Cmp On Pha FM Date HrMn Sec Err ErrMag Coda Amp Per > TTpred Res Weight StaLoc(X Y Z) SDist SAzim RAz RDip RQual Tcorr\nBURF ? ? ? P U ? ? ? ? ? ? ? ? > ? ? ? ? ? ? ? ? 114.7 93.0 ? ?\nREN ? ? ? P D ? ? ? ? ? ? ? ? > ? ? ? ? ? ? ? ? 302.4 137.7 ? ?\nGHA ? ? ? P U ? ? ? ? ? ? ? ? > ? ? ? ? ? ? ? ? 21.0 65.6 ? ?\nK190 ? ? ? P U ? ? ? ? ? ? ? ? > ? ? ? ? ? ? ? ? 311.9 91.9 ? ?\nSKI ? ? ? P U ? ? ? ? ? ? ? ? > ? ? ? ? ? ? ? ? 343.1 65.4 ? ?\nBLAF ? ? ? P D ? ? ? ? ? ? ? ? > ? ? ? ? ? ? ? ? 168.3 70.7 ? ?\nN66D ? ? ? P U ? ? ? ? ? ? ? ? > ? ? ? ? ? ? ? ? 357.4 65.1 ? ?\nVVAT ? ? ? P U ? ? ? ? ? ? ? ? > ? ? ? ? ? ? ? ? 359.6 65.0 ? ?\nK008 ? ? ? P U ? ? ? ? ? ? ? ? > ? ? ? ? ? ? ? ? 10.8 68.6 ? ?\nSKOG ? ? ? P U ? ? ? ? ? ? ? ? > ? ? ? ? ? ? ? ? 111.1 68.9 ? ?\nHVAN ? ? ? P D ? ? ? ? ? ? ? ? > ? ? ? ? ? ? ? ? 159.7 90.5 ? ?\nGUDF ? ? ? P U ? ? ? ? ? ? ? ? > ? ? ? ? ? ? ? ? 350.2 65.2 ? ?\nSVA ? ? ? P U ? ? ? ? ? ? ? ? > ? ? ? ? ? ? ? ? 207.9 55.9 ? ?\nK250 ? ? ? P U ? ? ? ? ? ? ? ? > ? ? ? ? ? ? ? ? 56.8 109.2 ? ?\nBUNG ? ? ? P U ? ? ? ? ? ? ? ? > ? ? ? ? ? ? ? ? 8.5 56.5 ? ?\nKVO ? ? ? P D ? ? ? ? ? ? ? ? > ? ? ? ? ? ? ? ? 351.9 94.8 ? ?\nTREB ? ? ? P D ? ? ? ? ? ? ? ? > ? ? ? ? ? ? ? ? 169.8 83.1 ? ?\nKODA ? ? ? P D ? ? ? ? ? ? ? ? > ? ? ? ? ? ? ? ? 177.1 65.2 ? ?\nK115 ? ? ? P D ? ? ? ? ? ? ? ? > ? ? ? ? ? ? ? ? 355.7 95.8 ? ?\nEND_PHASE\nEND_NLLOC\n'
        hyp_9 = 'NLLOC 20120620223428431\nSIGNATURE mtfit 1.0.0B/2015-10-21T16:42:43.389123\nCOMMENT mtfit inversion\nGRID None\nSEARCH None\nHYPOCENTER x ? y ? z ? OT ? ix ? iy ? iz ?\nGEOGRAPHIC OT ? ? ? ? ? ? Lat ? Long ? Depth ?\nQUALITY Pmax ? MFmin ? MFmax ? RMS ? Nphs ? Gap ? Dist ? Mamp ? ? Mdur ? ?\nVPVSRATIO ? ?\nSTATISTICS ExpectX ? Y ? Z ? CovXX ? XY ? XZ ? YY ? YZ ? ZZ ? EllAz1 ? Dip1 ? Len1 ? Az2 ? Dip2 ? Len2 ? Len3 ?\nTRANS None\nFOCALMECH ? ? ? Mech 174.543220852 47.6657193922 -64.744243488 mf 0 nObs 0\nPHASE ID Ins Cmp On Pha FM Date HrMn Sec Err ErrMag Coda Amp Per > TTpred Res Weight StaLoc(X Y Z) SDist SAzim RAz RDip RQual Tcorr\nBURF ? ? ? P U ? ? ? ? ? ? ? ? > ? ? ? ? ? ? ? ? 114.7 93.0 ? ?\nREN ? ? ? P D ? ? ? ? ? ? ? ? > ? ? ? ? ? ? ? ? 302.4 137.7 ? ?\nGHA ? ? ? P U ? ? ? ? ? ? ? ? > ? ? ? ? ? ? ? ? 21.0 65.6 ? ?\nK190 ? ? ? P U ? ? ? ? ? ? ? ? > ? ? ? ? ? ? ? ? 311.9 91.9 ? ?\nSKI ? ? ? P U ? ? ? ? ? ? ? ? > ? ? ? ? ? ? ? ? 343.1 65.4 ? ?\nBLAF ? ? ? P D ? ? ? ? ? ? ? ? > ? ? ? ? ? ? ? ? 168.3 70.7 ? ?\nN66D ? ? ? P U ? ? ? ? ? ? ? ? > ? ? ? ? ? ? ? ? 357.4 65.1 ? ?\nVVAT ? ? ? P U ? ? ? ? ? ? ? ? > ? ? ? ? ? ? ? ? 359.6 65.0 ? ?\nK008 ? ? ? P U ? ? ? ? ? ? ? ? > ? ? ? ? ? ? ? ? 10.8 68.6 ? ?\nSKOG ? ? ? P U ? ? ? ? ? ? ? ? > ? ? ? ? ? ? ? ? 111.1 68.9 ? ?\nHVAN ? ? ? P D ? ? ? ? ? ? ? ? > ? ? ? ? ? ? ? ? 159.7 90.5 ? ?\nGUDF ? ? ? P U ? ? ? ? ? ? ? ? > ? ? ? ? ? ? ? ? 350.2 65.2 ? ?\nSVA ? ? ? P U ? ? ? ? ? ? ? ? > ? ? ? ? ? ? ? ? 207.9 55.9 ? ?\nK250 ? ? ? P U ? ? ? ? ? ? ? ? > ? ? ? ? ? ? ? ? 56.8 109.2 ? ?\nBUNG ? ? ? P U ? ? ? ? ? ? ? ? > ? ? ? ? ? ? ? ? 8.5 56.5 ? ?\nKVO ? ? ? P D ? ? ? ? ? ? ? ? > ? ? ? ? ? ? ? ? 351.9 94.8 ? ?\nTREB ? ? ? P D ? ? ? ? ? ? ? ? > ? ? ? ? ? ? ? ? 169.8 83.1 ? ?\nKODA ? ? ? P D ? ? ? ? ? ? ? ? > ? ? ? ? ? ? ? ? 177.1 65.2 ? ?\nK115 ? ? ? P D ? ? ? ? ? ? ? ? > ? ? ? ? ? ? ? ? 355.7 95.8 ? ?\nEND_PHASE\nEND_NLLOC\n'
        hyps = [hyp_0, hyp_2, hyp_4, hyp_5, hyp_7, hyp_9, hyp_11]
        out = [0, 2, 4, 5, 7, 9, 11]
        open(uid+'.inv', 'w').write(inv_file)
        for j, i in enumerate(out):
            open(uid+'DC.'+str(i)+'.mt', 'w').write(mts[j])
            open(uid+'DC.'+str(i)+'.hyp', 'w').write(hyps[j])

    def clean_mpi(self):
        uid = "20120620223428431"
        try:
            os.remove(uid+'.inv')
        except:
            pass
        try:
            os.remove(uid+'DC.0.pkl')
        except:
            pass
        out = [0, 2, 4, 5, 7, 9, 11]
        for i in out:
            try:
                os.remove(uid+'DC.'+str(i)+'.mt')
            except:
                pass
            try:
                os.remove(uid+'DC.'+str(i)+'.hyp')
            except:
                pass
        try:
            os.remove(uid+'DC.mat')
        except:
            pass


def test_suite(verbosity=2):
    global VERBOSITY
    VERBOSITY = verbosity
    suite = [unittest.TestLoader().loadTestsFromTestCase(RunTestCase), ]
    suite = unittest.TestSuite(suite)
    return suite


def run_tests(verbosity=2):
    """Run tests"""
    _run_tests(test_suite(verbosity), verbosity)


def debug_tests(verbosity=2):
    """Runs tests with debugging on errors"""
    _debug_tests(test_suite(verbosity))


if __name__ == "__main__":
    # Run tests
    run_tests(verbosity=2)
